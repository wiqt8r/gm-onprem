# Обновление Docker-версии — Linux

Как и любое программное обеспечение, платформа **ГдеМои — Локальная версия** требует регулярного обновления, чтобы включать все последние улучшения и нововведения. В то время как облачная версия обновляется автоматически, обновления для локальных установок выполняются администраторами вручную.

Для Docker-версии процесс обновления максимально упрощён и не требует глубоких знаний системного администрирования.

Тем не менее, даже при минимальных требованиях к навыкам важно соблюдать осторожность и строго следовать инструкциям. Это позволит избежать повреждения данных и сохранить стабильность работы платформы.

## Подготовка к обновлению

Основной конфигурационный файл Docker-версии — **`.env`**, расположенный в каталоге `/navixy-package`. Откройте его в текстовом редакторе и проверьте значение параметра `WORKDIR`. Этот путь указывает на директорию, где хранятся критически важные данные платформы — база данных и конфигурационные файлы сервисов.

По умолчанию `WORKDIR=./work`, то есть рабочая папка находится внутри `/navixy-package`. Однако в некоторых случаях она может быть вынесена в другое место на сервере — уточните это перед началом обновления.

После проверки расположения данных можно переходить к процедуре обновления.

## Процесс обновления

### Шаг 1. Остановка текущей версии

Перейдите в каталог `/navixy-package` и выполните команду:

```
docker compose down
```

Это остановит все контейнеры текущей версии платформы.

### Шаг 2. Резервное копирование (рекомендуется)

Сделайте копию файлов:

* `.env`
* директории, указанной в `WORKDIR`

Это позволит безопасно откатиться в случае непредвиденных ошибок.

### Шаг 3. Распаковка новой версии

Распакуйте архив новой версии платформы (замените `<PACKAGE_NAME>` на имя файла):

```
tar -zxvf <PACKAGE_NAME>.tar.gz
```

Если вы выполняете распаковку в ту же директорию, где уже находится `/navixy-package`, **текущие файлы платформы будут перезаписаны**, однако данные и конфигурации не затрагиваются —  в архиве отсутствуют `.env` и `./work`.

### Шаг 4. Проверка и перенос конфигурации

Скопируйте файл `.env` из старой директории в новую `/navixy-package`. Если файл уже на месте, откройте его и убедитесь, что домены, пути и параметры указаны корректно.

### Шаг 5. Перенос рабочей директории

Если значение `WORKDIR` равно `./work`, переместите папку `/work` из старой директории в новую `/navixy-package`. Если используется отдельный путь (например, `/opt/navixy/work`), этот шаг можно пропустить.

### Шаг 6. Запуск обновлённой платформы

Находясь в новой директории `/navixy-package`, выполните команду:

```
docker compose up -d
```

Это запустит контейнеры новой версии платформы. Дождитесь завершения запуска — это займёт несколько минут.

## Завершение обновления

После успешного обновления можно удалить старую директорию `/navixy-package`, если она не была перезаписана новой версией.

Откройте браузер и проверьте доступность **панели администратора** и пользовательского интерфейса. Если всё работает корректно — обновление платформы завершено успешно.

Если при обновлении возникнут ошибки или контейнеры не запускаются, обратитесь в **отдел технических решений**: [solutions@gdemoi.ru](mailto:solutions@gdemoi.ru)
