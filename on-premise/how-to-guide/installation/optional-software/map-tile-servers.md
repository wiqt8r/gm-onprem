# Серверы тайлов карт

Сервер тайлов — это сервер, который предоставляет приложениям **ГдеМои — Локальная версия** картографические тайлы — небольшие квадратные изображения, из которых формируется карта.  
Развернув собственный сервер тайлов, вы можете предоставить пользователям индивидуальные карты для определённых областей или добавить дополнительные картографические слои, например объекты компании, наложенные поверх карты.

Чтобы добавить новый слой карт в платформу **ГдеМои — Локальная версия**, необходимо выполнить три основных шага:

1. **Подготовить тайлы карт.**  
   Сначала нужно преобразовать картографический документ в равномерные графические тайлы, каждый из которых связан с координатами (градусной сеткой) для всех уровней масштабирования.  
   Наиболее распространённый формат тайлов — **MBTiles**, однако можно использовать и другие, например **GeoTIFF**.  
   Независимо от формата, все файлы тайлов должны быть импортированы в **проекции Меркатора**, чтобы обеспечить корректное наложение слоёв на любые карты, используемые в платформе **ГдеМои**.  
   Размер тайлов также будет приведён к стандартному значению — **256 ppi**.

2. **Запустить сервер тайлов.**  
   После подготовки файлов тайлов их необходимо развернуть на сервере, где каждому файлу будет соответствовать прямая ссылка, например  
   [http://tileserver.com/{z}/{y}/{x}](http://tileserver.com/%7Bz%7D/%7By%7D/%7Bx%7D).  
   Вы можете использовать собственный сервер или облачный сервис от компаний **Mapbox**, **CartoDB**, **Esri** или **ArcGIS**.

3. **Добавить новый слой карт в интерфейс.**  
   После запуска сервера тайлов и загрузки картографических данных вы можете интегрировать их в интерфейс платформы, добавив новый внешний картографический слой и указав URL сервера тайлов.  
   Новый слой появится в списке доступных и может отображаться отдельно или совместно с другими слоями.

---

## Подготовка тайлов карт

Доступный картографический документ необходимо преобразовать в тайлы — равномерные графические элементы, связанные с координатами для каждого уровня масштабирования.  
Одним из наиболее популярных форматов тайлов является **MBTiles**, созданный [Mapbox](https://www.mapbox.com/), однако можно использовать и другие форматы, например **GeoTIFF**.

Независимо от используемого формата, все файлы тайлов должны быть импортированы в [проекции Меркатора](https://en.wikipedia.org/wiki/Mercator_projection).  
Это гарантирует корректное наложение пользовательских слоёв на любые карты, применяемые в платформе **ГдеМои**, поскольку все они используют проекцию Меркатора.  
Размер тайлов может отличаться, но будет автоматически приведён к наиболее распространённому формату — **256 ppi**.

![Тайлы карт](../../../../on-premise/on-premise/platform-installation/optional-software/attachments/image-20230810-131010.png)

---

## Запуск сервера тайлов

Необходимо развернуть подготовленные файлы тайлов на сервере.  
Каждый файл должен иметь прямую ссылку:  
`http://tileserver.com/{z}/{y}/{x}`  
Это позволяет получать корректный ответ при запросе:  
`//tileserver.com/{z}/{x}/{y}.png`  
Сервер тайлов может быть установлен локально или развернут в облаке.

---

### Вариант 1. Локальный сервер тайлов

Развёртывание собственного сервера тайлов — обычная задача системного администратора.  
Сам процесс настройки несложен, но сервер требует значительных вычислительных ресурсов и специализированного оборудования.

Сервер тайлов выполняет несколько ключевых функций:  
* рендеринг и подготовку тайлов к кэшированию;  
* распределение нагрузки и создание очереди запросов;  
* преобразование векторных данных в растровые тайлы;  
* загрузку поступающих данных в базу данных (если это предусмотрено);  
* управление базой данных через СУБД.

Чаще всего для таких задач используют операционные системы на базе **Unix**, поскольку это более просто и экономично.  
Кроме того, существуют готовые решения — например, можно развернуть сервер тайлов из пакетов **Ubuntu** с использованием **OpenStreetMap**.

---

### Вариант 2. Сторонние сервисы (SaaS)

Если вы не хотите запускать собственный сервер тайлов, можно воспользоваться услугами компаний, предоставляющих готовые решения для развёртывания и поддержки серверов тайлов.  
Они обеспечивают все необходимые ресурсы и инфраструктуру, поэтому вам не придётся заниматься настройкой и сопровождением.  
Среди наиболее популярных провайдеров — **Mapbox**, **CartoDB**, **Esri**, **ArcGIS**.

Платформа **ГдеМои — Локальная версия** поддерживает интеграцию с большинством таких решений.  
Для обсуждения подключения выбранного картографического провайдера свяжитесь с **отделом технических решений**:  
[solutions@gdemoi.ru](mailto:solutions@gdemoi.ru).
