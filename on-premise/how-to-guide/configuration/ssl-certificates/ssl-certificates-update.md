# Обновление SSL-сертификатов

## Установка SSL-сертификата

На этой странице приведены инструкции по обновлению истёкших SSL-сертификатов.  
Если вы устанавливаете SSL впервые (переходите с HTTP на HTTPS), см. раздел [Установка SSL-сертификатов](ssl-certificates-installation.md).

SSL-сертификаты имеют ограниченный срок действия, поэтому их необходимо переиздавать и обновлять на сервере до истечения срока.  
Процесс обновления не требует сложных навыков администрирования и выполняется в несколько простых шагов.

Платформа **ГдеМои** использует Nginx в качестве веб-сервера. Чтобы обновить сертификаты, достаточно найти текущие файлы сертификата и ключа в конфигурации Nginx и заменить их новыми.  

Для корректной работы веб-сервера необходимо, чтобы сертификат имел соответствующий ему приватный ключ. Без правильного ключа сервер не запустится.  
Обычно оба файла — сертификат и ключ — предоставляет центр сертификации.

## Обновление сертификатов

### Конфигурация Nginx на Linux

Файл конфигурации Nginx для вашего сайта находится по пути:

`/etc/nginx/sites-available/navixy.conf`

Откройте его любым текстовым редактором и найдите строки:

```
ssl_certificate /etc/nginx/ssl/certificate.crt;
ssl_certificate_key /etc/nginx/ssl/private.key;
```

Это значит, что файлы сертификата и ключа расположены в каталоге `/etc/nginx/ssl/`.  
Путь может быть записан короче, например `ssl/certificate.crt` — оба варианта корректны.

### Конфигурация Nginx на Windows

Файл конфигурации Nginx для сайта находится по адресу:

`C:\nginx\conf\sites-enabled\navixy.conf`

Внутри вы увидите строки:

```
ssl_certificate /ssl/certificate.crt;
ssl_certificate_key /ssl/private.key;
```

Запись `/ssl/` является сокращением пути `C:\nginx\conf\ssl`.  
Рекомендуется использовать именно этот путь, однако если сертификаты размещены в другом каталоге, укажите полный путь в конфигурации.

Если на платформе настроено несколько доменов (например, отдельные домены для API, панели администратора и пользовательского интерфейса),  
в конфигурации Nginx будет несколько блоков `server`, в каждом из которых указывается свой сертификат.  
Для корректной работы вам потребуется либо отдельный SSL-сертификат на каждый домен, либо wildcard-сертификат (например, `*.domain.com`), охватывающий все поддомены.

## Требования к сертификату

### Цепочка доверия

Для корректной работы SSL-сертификата должна быть настроена **полная цепочка доверия**.  
Это означает, что файл сертификата должен содержать не только основной сертификат, но и промежуточные и корневые сертификаты, создающие цепочку доверия до центра сертификации.

Если цепочка неполная, часть функций (например, мобильные приложения) может работать некорректно.  
При возникновении проблем с построением цепочки обратитесь к вашему провайдеру SSL.

### Проверка приватного ключа

Для запуска Nginx необходимо, чтобы приватный ключ соответствовал SSL-сертификату.  
Как правило, при продлении сертификата в том же центре сертификации используется тот же ключ, и заменять его не требуется.

Проверить соответствие сертификата и ключа можно с помощью онлайн-инструмента:  
[Certificate and Key Matcher](https://www.sslshopper.com/certificate-key-matcher.html)
