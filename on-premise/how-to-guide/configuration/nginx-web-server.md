# Веб-сервер Nginx

**Nginx** — это веб-сервер, используемый платформой **ГдеМои — Локальная версия** для работы веб-интерфейса.  
Это бесплатное программное обеспечение, разработанное для Linux и совместимое с Windows.

<div align="center">
<img src="../../../on-premise/on-premise/configuration/attachments/Nginx_server.png" alt="Логотип Nginx">
</div>

Nginx используется как в **Локальной версии**, так и на серверах **ServerMate (PaaS)**.  
Это единственный веб-сервер, полностью совместимый с платформой.  
Другие серверы, такие как Apache или IIS, **не поддерживаются**.

Если на вашем сервере вместе с платформой **ГдеМои** установлены другие веб-приложения, вы можете использовать для них другие типы веб-серверов параллельно с Nginx.  
В этом случае необходимо выполнить **разделение портов**, чтобы избежать конфликтов.

## Конфигурация Nginx

Настройка веб-сервера необходима для корректной работы сайта. Конфигурационные файлы определяют важные параметры:

* домен(ы) сайта;
* используемый протокол (HTTP/HTTPS);
* SSL-сертификаты;
* путь к файлам сайта;

и другие параметры, обеспечивающие стабильную работу веб-интерфейса.

### Конфигурация в Linux

В актуальной версии платформы **ГдеМои — Локальная версия** установка на Linux выполняется автоматически — как при установке через скрипты, так и при использовании Docker-контейнеров.  
Во всех этих случаях Nginx настраивается автоматически во время установки, и вносить изменения вручную не требуется.

Если установка выполнялась вручную ранее, существующие конфигурации остаются рабочими и не требуют изменений, за исключением случаев, когда вы хотите изменить домен или включить/отключить SSL.  
При необходимости внесения таких изменений рекомендуется обратиться в **отдел технических решений**: [solutions@gdemoi.ru](mailto:solutions@gdemoi.ru).

### Конфигурация в Windows

При установке платформы на Windows настройка выполняется вручную либо с помощью установочного скрипта.  
Для упрощения задачи в комплекте поставляются шаблоны конфигурационных файлов, которые можно использовать после подстановки реальных доменов и имён сертификатов.

Шаблоны находятся в папке `\windows\nginx` внутри распакованного дистрибутива `navixy-package`.  
Доступны два файла:

* `navixy.conf` — конфигурация для сайта, работающего по HTTP (без SSL);
* `navixy_ssl.conf` — конфигурация для сайта с SSL-защитой.

Выберите файл в зависимости от того, как планируется запуск сайта.

#### HTTP (без SSL)

Это самый простой вариант настройки.  
Для работы требуется только зарегистрированный домен, указывающий на ваш сервер.

1. Откройте файл `C:\nginx\conf\conf.d\navixy.conf`.
2. Замените переменные на реальные значения:
   * `${service_domain}` — домен пользовательского интерфейса при трёхдоменной установке, либо основной домен при однодоменной;
   * `${api_domain}` — домен API (удалите строку, если используется один домен);
   * `${panel_domain}` — домен панели администратора (удалите строку, если используется один домен).

Сохраните файл и перезапустите Nginx.  
Ваш сайт должен быть доступен по указанным доменам.

Для однодоменной установки:
* панель администратора будет доступна по адресу `http://my.domain.com/panel`;
* API — по адресу `http://my.domain.com/api`.

#### HTTPS (SSL-защищённый режим)

Для настройки сайта с SSL-шифрованием требуется зарегистрированный домен, действующий SSL-сертификат и соответствующий приватный ключ.

Более подробную информацию о сертификатах можно найти в разделе  
[Установка SSL-сертификатов](ssl-certificates/ssl-certificates-installation.md).

1. Поместите сертификат(ы) и приватный ключ(и) в папку `C:\nginx\ssl` (создайте её, если не существует).
2. Откройте файл `C:\nginx\conf\conf.d\navixy_ssl.conf` и замените переменные:
   * `${service_domain}` — домен пользовательского интерфейса;
   * `${api_domain}` — домен API (или удалите строку для одного домена);
   * `${panel_domain}` — домен панели администратора (или удалите строку для одного домена);
   * `${certificate_name}` — имя файла сертификата (с расширением);
   * `${private_key_name}` — имя файла приватного ключа (с расширением).

Сохраните изменения и перезапустите Nginx.  
После этого сайт будет доступен по HTTPS.

Для однодоменной установки:
* панель администратора — `https://my.domain.com/panel`
* API — `https://my.domain.com/api`

#### Перенаправление HTTP → HTTPS

Чтобы пользователи могли открывать платформу даже при вводе адреса без `https://`, необходимо включить перенаправление.

1. Используйте оба файла конфигурации — `navixy.conf` (HTTP) и `navixy_ssl.conf` (HTTPS).
2. В файле `navixy.conf` найдите строку:
```
#return 301 https://$host$request_uri;
```
3. Удалите символ `#`, чтобы раскомментировать строку.
4. Сохраните файл и перезапустите Nginx.

Теперь все HTTP-запросы будут автоматически перенаправляться на HTTPS
